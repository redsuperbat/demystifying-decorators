<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Demystifying Decorators</title>
    <link rel="icon" type="image/png" href="dist/favicon.ico" />
    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/moon.css" />

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/zenburn.css" />
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h2>Demystifying Decorators</h2>
          <p>How do <code>@Decorators()</code> really work?</p>
          <p>And what can they be used for? ü§∑</p>
        </section>
        <section>
          <pre>
						<code data-trim data-line-numbers>
							import "reflect-metadata";
							import { Injectable, createContainer } from 'slim-di';
							
							@Injectable()
							class FishingGear {}

							@Injectable()
							class FishingBoat {}

							@Injectable()
							class FisherManRoot {
								constructor(
									private readonly gear: FishingGear, 
									private readonly boat: FishingBoat
								){}
							}

							function main(){
								const container = createContainer(FisherManRoot);
								// Logs true
								console.log(container.get(FishingBoat) === container.get(FishingBoat))
							}
							main()
						</code>
					</pre>
        </section>
        <section>
          <h2 class="r-fit-text">‚ö†Ô∏è Disclaimer! ‚ö†Ô∏è</h2>
          <p class="r-fit-text">
            <a
              href="https://devblogs.microsoft.com/typescript/announcing-typescript-5-0/#decorators"
              target="_blank"
              >Typescript 5.0</a
            >
            just came out!
          </p>

          <aside class="notes">
            <ul>
              <li>
                Ecmascript decorator proposal has reached stage 3 (candidate).
              </li>
              <li>The legacy typescript decorator standard</li>
              <li>
                take years to adapt to the new standard when it eventually
                reaches stage 4
              </li>
            </ul>
          </aside>
        </section>
        <section>
          <section>
            <h2>What is a decorator?</h2>
            <small class="fragment fade-in">
              <ul>
                <li>
                  PropertyDecorator
                  <pre>
									<code data-line-numbers data-trim>
										class MyClass {
											@Input()
											myProp: string;
										}
									</code>
								</pre>
                </li>
                <li class="fragment fade-in">
                  MethodDecorator
                  <pre>
									<code data-line-numbers data-trim>
										class MyClass {
											@Computed()
											myMethod(){
												//
											};
										}
									</code>
								</pre>
                </li>
                <li class="fragment fade-in">
                  ClassDecorator

                  <pre>
									<code data-line-numbers data-trim>
										@Component()
										class MyComponent {}
									</code>
								</pre>
                </li>
              </ul>
            </small>

            <pre class="fragment fade-in">
						<code data-trim>
							// My first decorator üéâ
							function log() {
								console.log("What's up JS-Meetup? ‚ö°Ô∏èüöÄ")
							}
						</code>
					</pre>
          </section>

          <section>
            <small> company.ts </small>
            <pre>
						<code data-line-numbers="1-3|5-10|7-9|6|*" data-trim class="language-ts">
							function log(target: any, propertyKey: string, descriptor: any) {
								console.log("What's up JS-Meetup? ‚ö°Ô∏èüöÄ");
							}
							
							class Company {
								@log
								calculateSalary(salary: number) {
									return salary * 0.2;
								}
							}							
						</code>
					</pre>
            <pre class="fragment fade-in">
						<code data-trim data-line-numbers class="language-plaintext" >
							ts-node ./company.ts 
						</code>
						<code class="fragment fade-in language-plaintext" data-trim data-line-numbers >
							What's up JS-Meetup? ‚ö°Ô∏èüöÄ
						</code>
					</pre>
          </section>
        </section>
        <section>
          <small> company.ts (Method Decorator) </small>
          <!--	The property descriptor is a simple JavaScript object associated with each property of the 
					object that contains information about that property such as its value and other metadata -->
          <pre>
						<code  data-trim data-line-numbers="1-5|6|8-13|16-21|23-25">
							function log(
								target: Object,
								propertyKey: string,
								descriptor: PropertyDescriptor
							) {
								const originalMethod = descriptor.value;
							
								descriptor.value = function (this: any, ...args: any[]) {
									console.log(`INFO: Running function ${propertyKey} with input ${args}`);
									const res = originalMethod.call(this, ...args);
									console.log(`INFO: function ${propertyKey} ran with result¬†${res}`);
									return res;
								};
							}
							
							class Company {
								@log
								calculateSalary(salary: number) {
									return salary * 0.2;
								}
							}
							
							const c = new Company();
							c.calculateSalary(100);
							c.calculateSalary(75);						
						</code>
					</pre>

          <pre class="fragment fade-in">
						<code data-trim data-line-numbers class="language-plaintext" >
							ts-node ./company.ts 
						</code>

							<code
							class="fragment fade-in language-plaintext"
							data-trim
							data-line-numbers
							>
							INFO: Running function calculateSalary with input 100
							INFO: function calculateSalary ran with result 20
							INFO: Running function calculateSalary with input 75
							INFO: function calculateSalary ran with result 15
						</code>
					</pre>
        </section>
        <section>
          <small>company.ts (Property Decorator) </small>
          <pre>
						<code  data-trim data-line-numbers="1-15|16-26|29-30|37-39">
							// Method Decorator
							function log(
								target: Object,
								propertyKey: string,
								descriptor: PropertyDescriptor
							) {
								const originalMethod = descriptor.value;
							
								descriptor.value = function (this: any, ...args: any[]) {
									console.log(`INFO: Running function ${propertyKey} with input ${args}`);
									const res = originalMethod.call(this, ...args);
									console.log(`INFO: function ${propertyKey} ran with result¬†${res}`);
									return res;
								};
							}
							// Property Decorator
							function withBonus(target: Object, propertyKey: string) {
								Object.defineProperty(target, propertyKey, {
									get() {
										return this.value * 1.2;
									},
									set(value) {
										this.value = value;
									},
								});
							}
							
							class Company {
								@withBonus
								public total = 0;
								@log
								calculateSalary(salary: number) {
									return salary * 0.2;
								}
							}
							
							const c = new Company();
							c.total = 400;
							console.log("My total is:", c.total);												
						</code>
					</pre>

          <pre class="fragment fade-in">
						<code data-trim data-line-numbers class="language-plaintext" >
							ts-node ./company.ts 
						</code>

							<code
							class="fragment fade-in language-plaintext"
							data-trim
							data-line-numbers
							>
							My total is: 480
						</code>
					</pre>
        </section>
        <section>
          <section>
            <h1 class="r-fit-text">When should I use decorators?</h1>
            <p class="r-fit-text fragment fade-in">Just don't</p>
            <p class="r-fit-text fragment fade-in">Use cases are very rare!</p>
          </section>
          <section>
						<h2 style="margin-top: 15px;">Let the frameworks/libraries handle it! üöÄ</h2>
          
						<ul class="fragment fade-in" >
              <li>Frameworks like Angular</li>
              <li>Dependency injection like Nest.js</li>
              <li>Reactivity like stencil.js</li>
            </ul>
          </section>
        </section>
				<section>
					<h4>slim-di.ts üíâ</h4>
					<pre>
						<code data-trim data-line-numbers>
							import "reflect-metadata";

							function Injectable(): ClassDecorator {
								return function (target) {
									return target;
								};
							}

							export interface Type&lt;T = unknown&gt; extends Function {
								new (...args: any[]): T;
							}

							export interface DIContainer {
								get&lt;T = unknown&gt;(token: Type&lt;T&gt;): T;
							}

							export const createContainer = &lt;T&gt;(root: Type&lt;T&gt;): DIContainer => {
								const container = new Map&lt;Type, any>();

								const instantiateDeps = (token: Type): unknown => {
									if (container.get(token)) {
										return container.get(token);
									}

									const dependencyMetadata: Type[] =
										Reflect.getMetadata("design:paramtypes", token.prototype.constructor) ??
										[];

									const instance = new token(
										...dependencyMetadata.map((it) => instantiateDeps(it))
									);
									container.set(token, instance);
									return instance;
								};

								instantiateDeps(root);

								return {
									get(token) {
										return container.get(token);
									},
								};
							};

							@Injectable()
							class FishingGear {}

							@Injectable()
							class FishingBoat {}

							@Injectable()
							class FisherManRoot {
								constructor(
									private readonly gear: FishingGear,
									private readonly boat: FishingBoat
								) {}
							}

							function main() {
								const container = createContainer(FisherManRoot);
								// Logs true
								console.log(container.get(FishingBoat) === container.get(FishingBoat));
							}
							main();
						</code>
					</pre>
				</section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
      });
    </script>
  </body>
</html>
